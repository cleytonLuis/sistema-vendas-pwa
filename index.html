<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GK Suplementos</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <!-- Manifest do PWA (serÃ¡ atualizado automaticamente pelo script) -->
  <link rel="manifest" href="manifest.json">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
	  <header class="navbar">
	  <div class="navbar-left">
		<a href="/index.html" class="logo">
		  <img src="/img/logo.png" alt="Logo da empresa" class="logo-img">
		</a>
	  </div>

	  <nav class="navbar-links">
		<a href="/index.html" class="active">ğŸ“Š Dashboard</a>

		<div class="dropdown menu-item">
		  <a href="#" class="dropdown-toggle">ğŸ›’ Vendas</a>
		  <ul class="dropdown-menu">
			<li><a href="/cadastro.html">Cadastrar Venda</a></li>
			<li><a href="/acompanhamento-vendas.html">Acompanhar Vendas</a></li>
		  </ul>
		</div>

		<a href="/produtos.html">ğŸ“¦ Produtos</a>
		<a href="/estoque.html">ğŸ“¦ Estoque</a>

		<div class="nav-right">
		  <button id="btnLogout" class="btn-logout">Sair</button>
		</div>
	  </nav>
	</header>

  <div class="container">
	<!-- FILTROS -->
    <div class="filters dashboard-cards" style="align-items:center;">
      <label>InÃ­cio <input type="date" id="inicio"></label>
      <label>Fim <input type="date" id="fim"></label>
      <button id="btnFiltro" class="btn">Aplicar</button>
      <button id="btnHoje" class="btn">Hoje</button>
      <button id="btnLimpar" class="btn" style="background:#6b7280;margin-left:8px;">Limpar Filtros</button>
    </div>

	<h3>Estoque disponÃ­vel</h3>
		<div class="dashboard-cards">
		<!-- ğŸ”¹ NOVO CONTAINER DE CARDS DE ESTOQUE -->
		<section id="resumoEstoque" class="resumo-financeiro">
		  <!-- Cards dos produtos em maior estoque serÃ£o carregados aqui -->
		</section>
		</div>
	
	<!-- ğŸ”¹ Grupo Operacional -->
	<h3 class="kpi-titulo grupo-operacional">Indicadores Operacionais</h3>
	<div class="dashboard-cards grupo-operacional">
	  <div class="card">
		<h3>ğŸ“¦ Estoque Entrada</h3>
		<p id="kpiEstoque">0</p>
	  </div>
	  <div class="card">
		<h3>ğŸ“¤ Estoque SaÃ­da</h3>
		<p id="kpiEstoqueSaida">0</p>
	  </div>
	  <div class="card">
		<h3>ğŸ“¦ Itens Vendidos</h3>
		<p id="kpiItens">0</p>
	  </div>
	  <div class="card">
		<h3>ğŸ‘¥ Clientes</h3>
		<p id="kpiClientes">0</p>
	  </div>
	</div>

	<!-- ğŸ”¹ Grupo Financeiro -->
	<h3 class="kpi-titulo grupo-financeiro">Indicadores Financeiros</h3>
	<div class="dashboard-cards grupo-financeiro">
	  <div class="card">
		<h3>ğŸ’° Receita Total</h3>
		<p id="kpiReceita">R$ 0,00</p>
	  </div>
	  <div class="card">
		<h3>ğŸ§¾ Total de Vendas</h3>
		<p id="kpiVendas">0</p>
	  </div>
	  <div class="card">
		<h3>ğŸ“Š Margem de Lucro</h3>
		<p id="margemLucro">0%</p>
	  </div>
	  <div class="card">
		<h3>ğŸŸï¸ Ticket MÃ©dio</h3>
		<p id="kpiTicket">R$ 0,00</p>
	  </div>
	</div>

	<!-- ğŸ”¹ Grupo Totais -->
	<h3 class="kpi-titulo grupo-totais">Indicadores Totais</h3>
	<div class="dashboard-cards grupo-totais">
	  <div class="card">
		<h3>ğŸ’¼ Investimento Total</h3>
		<p id="investimentoTotal">R$ 0,00</p>
	  </div>
	  <div class="card">
		<h3>ğŸ“Š Faturamento Total</h3>
		<p id="faturamentoTotal">R$ 0,00</p>
	  </div>
	  <div class="card">
		<h3>ğŸ’¹ Lucro Total</h3>
		<p id="lucroTotal">R$ 0,00</p>
	  </div>
	</div>
	</section>
	
    <!-- GRÃFICO PRINCIPAL -->
    <div class="chart-section" style="margin-top:25px;">
      <h3>Receita por Dia</h3>
      <canvas id="chartRevenue" height="140"></canvas>
    </div>

    <!-- GRÃFICOS SECUNDÃRIOS -->
    <div class="dashboard-cards" style="margin-top:22px;">
      <div class="card">
        <h3>Top 5 Produtos (Quantidade)</h3>
        <canvas id="chartTopProducts" height="180"></canvas>
      </div>

      <div class="card">
        <h3>Receita por Categoria</h3>
        <canvas id="chartCategory" height="180"></canvas>
      </div>

      <div class="card">
        <h3>Top Clientes (Receita)</h3>
        <canvas id="chartTopClients" height="180"></canvas>
      </div>
    </div>
  </div>

  <script src="/js/dashboard.js"></script>
 <script src="/js/logout.js"></script>
 
 <script>
	// Ao carregar, pegamos manifest.json (vezes serve como "arquivo de configuraÃ§Ã£o" com a URL atual).
    // O campo `app_url` Ã© onde o update_link.py grava a URL do tunnel.
    (async function() {
      try {
        const res = await fetch('manifest.json', {cache: "no-store"});
        if (!res.ok) throw new Error('NÃ£o foi possÃ­vel carregar manifest.json');
        const manifest = await res.json();
        const destino = manifest.app_url;
        if (destino && destino.startsWith('http')) {
          // Redireciona o usuÃ¡rio para a URL de produÃ§Ã£o real do sistema.
          window.location.href = destino;
        } else {
          document.getElementById('linkFallback').href = '/';
        }
      } catch (err) {
        console.error('Erro ao carregar manifest.json:', err);
        document.getElementById('linkFallback').href = '/';
      }
 </script>
</body>
</html>
